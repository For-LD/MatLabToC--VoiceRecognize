//
// File: stft.cpp
//
// MATLAB Coder version            : 5.0
// C/C++ source code generated on  : 23-Oct-2020 20:33:52
//

// Include Files
#include "stft.h"
#include "DeepLearningNetwork.h"
#include "FFTImplementationCallback.h"
#include "VoiceRecognize.h"
#include "matlabCodegenHandle.h"
#include "rt_nonfinite.h"
#include <cstring>

// Function Definitions

//
// Arguments    : const double x[16000]
//                double Yb[25186]
// Return Type  : void
//
void stft(const double x[16000], double Yb[25186])
{
  int hop;
  static double a[39200];
  static double y[39200];
  int y_tmp;
  int k;
  static creal_T Y[50176];
  static const double dv[400] = { 0.080000000000000016, 0.080056749058436127,
    0.0802269822317635, 0.080510657517493811, 0.0809077049229951,
    0.081418026482761141, 0.082041496282583226, 0.082777960490617364,
    0.08362723739534017, 0.084589117450383555, 0.085663363326236641,
    0.086849709968804034, 0.088147864664803177, 0.089557507113987744,
    0.0910782895081762, 0.092709836617068775, 0.094451745880829718,
    0.096303587509412925, 0.0982649045886062, 0.10033521319276817,
    0.10251400250422937, 0.10480073493932918, 0.1071948462810563,
    0.10969574581826108, 0.11230281649140433, 0.11501541504480811,
    0.1178328721853687, 0.12075449274769517, 0.12377955586563105,
    0.12690731515011683, 0.13013699887335078, 0.133467810159201,
    0.13689892717982277, 0.14042950335843207, 0.14405866757818592,
    0.14778552439711756, 0.15160915426907307, 0.15552861377059568,
    0.1595429358337016, 0.16365112998448927, 0.16785218258752421,
    0.17214505709593836, 0.17652869430718243, 0.18100201262436832,
    0.18556390832313696, 0.19021325582398579, 0.19494890796998865,
    0.19976969630983954, 0.20467443138615071, 0.20966190302893312,
    0.21473088065418816, 0.21988011356753545, 0.22510833127280322,
    0.23041424378550429, 0.23579654195112021, 0.24125389776811557,
    0.24678496471560279, 0.25238837808557557, 0.2580627553196308,
    0.26380669635009335, 0.2696187839454624, 0.27549758406009189,
    0.28144164618802, 0.28744950372085942, 0.29351967430966164,
    0.29965066023066356, 0.30584094875482926, 0.31208901252109256,
    0.318393309913211, 0.32475228544013623, 0.33116437011980848,
    0.337627981866279, 0.34414152588006663, 0.35070339504164993,
    0.357311970308001, 0.36396562111205871, 0.37066270576504812,
    0.37740157186154177, 0.38418055668716594, 0.3909979876288513,
    0.39785218258752419, 0.40474145039314025, 0.41166409122195446,
    0.41861839701592846, 0.42560265190416674, 0.43261513262628348,
    0.43965410895759038, 0.44671784413600429, 0.45380459529056666,
    0.46091261387147164, 0.4680401460814938, 0.47518543330871205,
    0.48234671256042005, 0.48952221689811926, 0.49671017587348337,
    0.50390881596519133, 0.51111636101651581, 0.5183310326735644,
    0.525551050824061, 0.53277463403656256, 0.54, 0.54722536596343752,
    0.554448949175939, 0.56166896732643556, 0.56888363898348415,
    0.57609118403480863, 0.58328982412651664, 0.59047778310188082,
    0.59765328743958, 0.60481456669128808, 0.61195985391850627,
    0.61908738612852843, 0.62619540470943347, 0.63328215586399561,
    0.64034589104240958, 0.64738486737371637, 0.65439734809583316,
    0.66138160298407145, 0.6683359087780455, 0.67525854960685971,
    0.68214781741247577, 0.68900201237114866, 0.69581944331283407,
    0.7025984281384583, 0.70933729423495184, 0.7160343788879413,
    0.72268802969199908, 0.72929660495835, 0.73585847411993344,
    0.742372018133721, 0.74883562988019159, 0.75524771455986373,
    0.76160669008678916, 0.76791098747890751, 0.77415905124517082,
    0.78034933976933651, 0.78648032569033854, 0.79255049627914076,
    0.79855835381198, 0.804502415939908, 0.81038121605453761,
    0.81619330364990672, 0.82193724468036911, 0.82761162191442428,
    0.83321503528439733, 0.8387461022318845, 0.84420345804887986,
    0.84958575621449572, 0.8548916687271968, 0.86011988643246462,
    0.86526911934581185, 0.87033809697106679, 0.87532556861384925,
    0.88023030369016053, 0.88505109203001142, 0.88978674417601422,
    0.894436091676863, 0.89899798737563175, 0.90347130569281764,
    0.90785494290406166, 0.91214781741247575, 0.91634887001551091,
    0.92045706416629858, 0.92447138622940428, 0.92839084573092689,
    0.93221447560288251, 0.9359413324218141, 0.93957049664156789,
    0.94310107282017719, 0.946532189840799, 0.94986300112664923,
    0.95309268484988319, 0.95622044413436891, 0.959245507252305,
    0.96216712781463132, 0.9649845849551919, 0.96769718350859568,
    0.970304254181739, 0.97280515371894372, 0.97519926506067089,
    0.9774859974957707, 0.9796647868072319, 0.98173509541139392,
    0.98369641249058715, 0.98554825411917035, 0.9872901633829313,
    0.98892171049182387, 0.99044249288601227, 0.99185213533519678,
    0.993150290031196, 0.99433663667376337, 0.99541088254961652,
    0.9963727626046599, 0.99722203950938271, 0.99795850371741679,
    0.998581973517239, 0.99909229507700492, 0.9994893424825062,
    0.99977301776823657, 0.999943250941564, 1.0, 0.999943250941564,
    0.99977301776823657, 0.9994893424825062, 0.99909229507700492,
    0.998581973517239, 0.99795850371741679, 0.99722203950938271,
    0.9963727626046599, 0.99541088254961652, 0.99433663667376337,
    0.993150290031196, 0.99185213533519678, 0.99044249288601227,
    0.98892171049182387, 0.9872901633829313, 0.98554825411917035,
    0.98369641249058715, 0.98173509541139392, 0.9796647868072319,
    0.9774859974957707, 0.97519926506067089, 0.97280515371894372,
    0.970304254181739, 0.96769718350859568, 0.9649845849551919,
    0.96216712781463132, 0.959245507252305, 0.95622044413436891,
    0.95309268484988319, 0.94986300112664923, 0.946532189840799,
    0.94310107282017719, 0.93957049664156789, 0.9359413324218141,
    0.93221447560288251, 0.92839084573092689, 0.92447138622940428,
    0.92045706416629858, 0.91634887001551091, 0.91214781741247575,
    0.90785494290406166, 0.90347130569281764, 0.89899798737563175,
    0.894436091676863, 0.88978674417601422, 0.88505109203001142,
    0.88023030369016053, 0.87532556861384925, 0.87033809697106679,
    0.86526911934581185, 0.86011988643246462, 0.8548916687271968,
    0.84958575621449572, 0.84420345804887986, 0.8387461022318845,
    0.83321503528439733, 0.82761162191442428, 0.82193724468036911,
    0.81619330364990672, 0.81038121605453761, 0.804502415939908,
    0.79855835381198, 0.79255049627914076, 0.78648032569033854,
    0.78034933976933651, 0.77415905124517082, 0.76791098747890751,
    0.76160669008678916, 0.75524771455986373, 0.74883562988019159,
    0.742372018133721, 0.73585847411993344, 0.72929660495835,
    0.72268802969199908, 0.7160343788879413, 0.70933729423495184,
    0.7025984281384583, 0.69581944331283407, 0.68900201237114866,
    0.68214781741247577, 0.67525854960685971, 0.6683359087780455,
    0.66138160298407145, 0.65439734809583316, 0.64738486737371637,
    0.64034589104240958, 0.63328215586399561, 0.62619540470943347,
    0.61908738612852843, 0.61195985391850627, 0.60481456669128808,
    0.59765328743958, 0.59047778310188082, 0.58328982412651664,
    0.57609118403480863, 0.56888363898348415, 0.56166896732643556,
    0.554448949175939, 0.54722536596343752, 0.54, 0.53277463403656256,
    0.525551050824061, 0.5183310326735644, 0.51111636101651581,
    0.50390881596519133, 0.49671017587348337, 0.48952221689811926,
    0.48234671256042005, 0.47518543330871205, 0.4680401460814938,
    0.46091261387147164, 0.45380459529056666, 0.44671784413600429,
    0.43965410895759038, 0.43261513262628348, 0.42560265190416674,
    0.41861839701592846, 0.41166409122195446, 0.40474145039314025,
    0.39785218258752419, 0.3909979876288513, 0.38418055668716594,
    0.37740157186154177, 0.37066270576504812, 0.36396562111205871,
    0.357311970308001, 0.35070339504164993, 0.34414152588006663,
    0.337627981866279, 0.33116437011980848, 0.32475228544013623,
    0.318393309913211, 0.31208901252109256, 0.30584094875482926,
    0.29965066023066356, 0.29351967430966164, 0.28744950372085942,
    0.28144164618802, 0.27549758406009189, 0.2696187839454624,
    0.26380669635009335, 0.2580627553196308, 0.25238837808557557,
    0.24678496471560279, 0.24125389776811557, 0.23579654195112021,
    0.23041424378550429, 0.22510833127280322, 0.21988011356753545,
    0.21473088065418816, 0.20966190302893312, 0.20467443138615071,
    0.19976969630983954, 0.19494890796998865, 0.19021325582398579,
    0.18556390832313696, 0.18100201262436832, 0.17652869430718243,
    0.17214505709593836, 0.16785218258752421, 0.16365112998448927,
    0.1595429358337016, 0.15552861377059568, 0.15160915426907307,
    0.14778552439711756, 0.14405866757818592, 0.14042950335843207,
    0.13689892717982277, 0.133467810159201, 0.13013699887335078,
    0.12690731515011683, 0.12377955586563105, 0.12075449274769517,
    0.1178328721853687, 0.11501541504480811, 0.11230281649140433,
    0.10969574581826108, 0.1071948462810563, 0.10480073493932918,
    0.10251400250422937, 0.10033521319276817, 0.0982649045886062,
    0.096303587509412925, 0.094451745880829718, 0.092709836617068775,
    0.0910782895081762, 0.089557507113987744, 0.088147864664803177,
    0.086849709968804034, 0.085663363326236641, 0.084589117450383555,
    0.08362723739534017, 0.082777960490617364, 0.082041496282583226,
    0.081418026482761141, 0.0809077049229951, 0.080510657517493811,
    0.0802269822317635, 0.080056749058436127 };

  static creal_T b_Yb[25186];
  for (hop = 0; hop < 98; hop++) {
    y_tmp = 160 * hop;
    std::memcpy(&y[hop * 400], &x[y_tmp], 400U * sizeof(double));
  }

  std::memcpy(&a[0], &y[0], 39200U * sizeof(double));
  for (hop = 0; hop < 98; hop++) {
    for (k = 0; k < 400; k++) {
      y_tmp = k + 400 * hop;
      y[y_tmp] = a[y_tmp] * dv[k];
    }
  }

  for (hop = 0; hop < 98; hop++) {
    std::memset(&Y[hop * 512], 0, 512U * sizeof(creal_T));
    FFTImplementationCallback::doHalfLengthRadix2((y), (hop * 400), (*(creal_T (*)
      [512])&Y[hop << 9]));
  }

  for (y_tmp = 0; y_tmp < 98; y_tmp++) {
    for (k = 0; k < 257; k++) {
      double re;
      double im;
      hop = k + (y_tmp << 9);
      re = Y[hop].re * Y[hop].re - Y[hop].im * -Y[hop].im;
      im = Y[hop].re * -Y[hop].im + Y[hop].im * Y[hop].re;
      if (im == 0.0) {
        hop = k + 257 * y_tmp;
        b_Yb[hop].re = re / 23328.000000000044;
        b_Yb[hop].im = 0.0;
      } else if (re == 0.0) {
        hop = k + 257 * y_tmp;
        b_Yb[hop].re = 0.0;
        b_Yb[hop].im = im / 23328.000000000044;
      } else {
        hop = k + 257 * y_tmp;
        b_Yb[hop].re = re / 23328.000000000044;
        b_Yb[hop].im = im / 23328.000000000044;
      }
    }

    b_Yb[257 * y_tmp].re *= 0.5;
    b_Yb[257 * y_tmp].im *= 0.5;
    k = 257 * y_tmp + 256;
    b_Yb[k].re *= 0.5;
    b_Yb[k].im *= 0.5;
  }

  for (y_tmp = 0; y_tmp < 25186; y_tmp++) {
    Yb[y_tmp] = b_Yb[y_tmp].re;
  }
}

//
// File trailer for stft.cpp
//
// [EOF]
//
